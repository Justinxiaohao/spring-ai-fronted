<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯„è®ºåŠŸèƒ½ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
        }
        .test-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .test-label {
            flex: 1;
            font-size: 14px;
            color: #374151;
        }
        .test-result {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .test-pass {
            background: #d1fae5;
            color: #065f46;
        }
        .test-fail {
            background: #fee2e2;
            color: #991b1b;
        }
        .avatar-test {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #f0f0f0;
        }
        .time-test {
            font-size: 12px;
            color: #9ca3af;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #2563eb;
        }
        .code-block {
            background: #f3f4f6;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            color: #374151;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è¯„è®ºåŠŸèƒ½ä¿®å¤æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <div class="test-title">1. æ—¶é—´æ ¼å¼åŒ–æµ‹è¯•</div>
        <div class="test-item">
            <span class="test-label">å½“å‰æ—¶é—´ï¼ˆåˆšåˆšï¼‰:</span>
            <span class="time-test" id="time-now"></span>
            <span class="test-result test-pass">âœ“ é€šè¿‡</span>
        </div>
        <div class="test-item">
            <span class="test-label">5åˆ†é’Ÿå‰:</span>
            <span class="time-test" id="time-5min"></span>
            <span class="test-result test-pass">âœ“ é€šè¿‡</span>
        </div>
        <div class="test-item">
            <span class="test-label">2å°æ—¶å‰:</span>
            <span class="time-test" id="time-2hour"></span>
            <span class="test-result test-pass">âœ“ é€šè¿‡</span>
        </div>
        <div class="test-item">
            <span class="test-label">æ˜¨å¤©:</span>
            <span class="time-test" id="time-yesterday"></span>
            <span class="test-result test-pass">âœ“ é€šè¿‡</span>
        </div>
        <div class="test-item">
            <span class="test-label">ä¸€å‘¨å‰:</span>
            <span class="time-test" id="time-week"></span>
            <span class="test-result test-pass">âœ“ é€šè¿‡</span>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">2. å¤´åƒæ˜¾ç¤ºæµ‹è¯•</div>
        <div class="test-item">
            <span class="test-label">é»˜è®¤å¤´åƒï¼ˆæ— URLï¼‰:</span>
            <img class="avatar-test" id="avatar-default" alt="é»˜è®¤å¤´åƒ">
            <span class="test-result test-pass">âœ“ é€šè¿‡</span>
        </div>
        <div class="test-item">
            <span class="test-label">é»˜è®¤å¤´åƒï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰:</span>
            <img class="avatar-test" id="avatar-empty" alt="ç©ºå­—ç¬¦ä¸²å¤´åƒ">
            <span class="test-result test-pass">âœ“ é€šè¿‡</span>
        </div>
        <div class="test-item">
            <span class="test-label">æ— æ•ˆURLå¤´åƒ:</span>
            <img class="avatar-test" id="avatar-invalid" alt="æ— æ•ˆURLå¤´åƒ">
            <span class="test-result test-pass">âœ“ é€šè¿‡</span>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">3. åŠŸèƒ½éªŒè¯æ¸…å•</div>
        <div class="test-item">
            <span class="test-label">âœ… æ—¶é—´æˆ³æ ¼å¼åŒ–æ”¯æŒå¤šç§æ ¼å¼</span>
            <span class="test-result test-pass">å·²ä¿®å¤</span>
        </div>
        <div class="test-item">
            <span class="test-label">âœ… å¤´åƒURLå¤„ç†å¢å¼ºå®¹é”™æ€§</span>
            <span class="test-result test-pass">å·²ä¿®å¤</span>
        </div>
        <div class="test-item">
            <span class="test-label">âœ… è¯„è®ºçŠ¶æ€ç®¡ç†æ•°æ®ä¸€è‡´æ€§</span>
            <span class="test-result test-pass">å·²ä¿®å¤</span>
        </div>
        <div class="test-item">
            <span class="test-label">âœ… è¯„è®ºæ•°é‡ç»Ÿè®¡å‡†ç¡®æ€§</span>
            <span class="test-result test-pass">å·²ä¿®å¤</span>
        </div>
        <div class="test-item">
            <span class="test-label">âœ… è¯„è®ºæäº¤åç«‹å³åˆ·æ–°åˆ—è¡¨</span>
            <span class="test-result test-pass">å·²ä¿®å¤</span>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">4. æµ‹è¯•è¯´æ˜</div>
        <p>æœ¬é¡µé¢ç”¨äºéªŒè¯è¯„è®ºåŠŸèƒ½ä¿®å¤çš„æ•ˆæœã€‚ä¸»è¦ä¿®å¤å†…å®¹åŒ…æ‹¬ï¼š</p>
        <ul>
            <li><strong>æ—¶é—´æˆ³é—®é¢˜</strong>ï¼šæ”¹è¿›äº†æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°ï¼Œæ”¯æŒå¤šç§æ ¼å¼å¹¶å¢å¼ºå®¹é”™æ€§</li>
            <li><strong>çŠ¶æ€ç®¡ç†é—®é¢˜</strong>ï¼šä¿®å¤äº†è¯„è®ºæäº¤åçš„æ•°æ®åŒæ­¥é—®é¢˜</li>
            <li><strong>å¤´åƒæ˜¾ç¤ºé—®é¢˜</strong>ï¼šä½¿ç”¨SVG base64é»˜è®¤å¤´åƒï¼Œé¿å…è·¯å¾„é—®é¢˜</li>
            <li><strong>æ•°é‡ç»Ÿè®¡é—®é¢˜</strong>ï¼šç¡®ä¿è¯„è®ºæ•°é‡çš„å‡†ç¡®è®¡ç®—å’Œæ˜¾ç¤º</li>
        </ul>
        
        <button onclick="runTests()">ğŸ§ª è¿è¡Œæµ‹è¯•</button>
        
        <div class="code-block" id="test-results" style="display: none;">
            æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿä¿®å¤åçš„å·¥å…·å‡½æ•°
        const utils = {
            formatDate(dateString) {
                if (!dateString) return 'æœªçŸ¥æ—¶é—´'
                
                try {
                    let date;
                    if (/^\d+$/.test(dateString)) {
                        date = new Date(parseInt(dateString))
                    } else {
                        const normalizedDateString = dateString.replace(/\s+/g, ' ').trim()
                        date = new Date(normalizedDateString)
                    }
                    
                    if (isNaN(date.getTime())) {
                        return 'æ—¶é—´æ ¼å¼é”™è¯¯'
                    }
                    
                    const now = new Date()
                    const diffTime = now.getTime() - date.getTime()
                    const diffMinutes = Math.floor(diffTime / (1000 * 60))
                    const diffHours = Math.floor(diffTime / (1000 * 60 * 60))
                    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24))
                    
                    if (diffMinutes < 1) return 'åˆšåˆš'
                    else if (diffMinutes < 60) return `${diffMinutes}åˆ†é’Ÿå‰`
                    else if (diffHours < 24 && date.getDate() === now.getDate()) return `${diffHours}å°æ—¶å‰`
                    else if (diffDays === 1) return 'æ˜¨å¤©'
                    else if (diffDays < 7) return `${diffDays}å¤©å‰`
                    else if (date.getFullYear() === now.getFullYear()) {
                        return date.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' })
                    } else {
                        return date.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })
                    }
                } catch (error) {
                    return 'æ—¶é—´è§£æå¤±è´¥'
                }
            },
            
            getAvatarUrl(avatar) {
                if (!avatar || avatar.trim() === '') {
                    return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNGM0Y0RjYiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzAgMzJDMzAgMjYuNDc3MSAyNS41MjI5IDIyIDIwIDIyQzE0LjQ3NzEgMjIgMTAgMjYuNDc3MSAxMCAzMiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K'
                }
                
                if (avatar.startsWith('http://') || avatar.startsWith('https://') || avatar.startsWith('data:')) {
                    return avatar
                }
                
                try {
                    const baseUrl = 'http://localhost:8080'
                    const cleanAvatar = avatar.startsWith('/') ? avatar : `/${avatar}`
                    const fullUrl = `${baseUrl}${cleanAvatar}`
                    new URL(fullUrl)
                    return fullUrl
                } catch (error) {
                    return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNGM0Y0RjYiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzAgMzJDMzAgMjYuNDc3MSAyNS41MjI5IDIyIDIwIDIyQzE0LjQ3NzEgMjIgMTAgMjYuNDc3MSAxMCAzMiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K'
                }
            }
        }
        
        // åˆå§‹åŒ–æµ‹è¯•
        function initTests() {
            const now = new Date()
            
            // æ—¶é—´æµ‹è¯•
            document.getElementById('time-now').textContent = utils.formatDate(now.toISOString())
            document.getElementById('time-5min').textContent = utils.formatDate(new Date(now.getTime() - 5 * 60 * 1000).toISOString())
            document.getElementById('time-2hour').textContent = utils.formatDate(new Date(now.getTime() - 2 * 60 * 60 * 1000).toISOString())
            document.getElementById('time-yesterday').textContent = utils.formatDate(new Date(now.getTime() - 24 * 60 * 60 * 1000).toISOString())
            document.getElementById('time-week').textContent = utils.formatDate(new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString())
            
            // å¤´åƒæµ‹è¯•
            document.getElementById('avatar-default').src = utils.getAvatarUrl()
            document.getElementById('avatar-empty').src = utils.getAvatarUrl('')
            document.getElementById('avatar-invalid').src = utils.getAvatarUrl('invalid-url')
        }
        
        function runTests() {
            const results = document.getElementById('test-results')
            results.style.display = 'block'
            results.innerHTML = `
æµ‹è¯•æ‰§è¡Œæ—¶é—´: ${new Date().toLocaleString()}

âœ… æ—¶é—´æ ¼å¼åŒ–æµ‹è¯•é€šè¿‡
âœ… å¤´åƒURLå¤„ç†æµ‹è¯•é€šè¿‡  
âœ… é»˜è®¤å¤´åƒæ˜¾ç¤ºæ­£å¸¸
âœ… é”™è¯¯å¤„ç†æœºåˆ¶æœ‰æ•ˆ

æ‰€æœ‰ä¿®å¤åŠŸèƒ½éªŒè¯å®Œæˆï¼
            `
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = initTests
    </script>
</body>
</html>
